<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Hospitals - Best Rated Hospitals</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <nav class="nav container">
            <div class="nav-brand">
                <img src="assets/img/logo.png" alt="Best Rated Hospitals" class="nav-logo" style="height: 40px; margin-right: 12px; vertical-align: middle;">
                <span>Best Rated Hospitals</span>
            </div>
            <button class="nav-toggle" onclick="toggleMobileNav()">
                <span class="icon">menu</span>
            </button>
            <ul class="nav-links" id="navLinks">
                <li><a href="index.html">Home</a></li>
                <li><a href="search.html">Search</a></li>
                <li><a href="login.html">Login</a></li>
                <li><a href="register.html">Register</a></li>
            </ul>
        </nav>
    </header>

    <main class="main-content" style="background: linear-gradient(135deg, rgba(248, 250, 252, 0.95) 0%, rgba(241, 245, 249, 0.9) 100%), url('assets/img/bg.jpg'); background-size: cover; background-position: center; background-attachment: fixed; min-height: 100vh; padding: 40px 0;">
        <div class="container">
            <!-- Hero Search Section -->
            <div class="search-hero" style="text-align: center; margin-bottom: 40px;">
                <div class="hero-icon" style="width: 100px; height: 100px; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; box-shadow: 0 8px 32px rgba(67, 146, 241, 0.3);">
                    <i class="material-icons" style="font-size: 48px; color: white;">search</i>
                </div>
                <h1 style="color: var(--text-primary); margin-bottom: 16px; font-size: clamp(2rem, 4vw, 2.5rem);">Find Healthcare Providers</h1>
                <p style="color: var(--text-secondary); font-size: 1.1rem; max-width: 600px; margin: 0 auto;">Search through thousands of verified hospitals, clinics, and healthcare professionals to find the best care for your needs.</p>
            </div>
            
            <!-- Search Card -->
            <div class="card" style="margin-bottom: 40px; border-radius: 20px; box-shadow: 0 12px 40px rgba(0,0,0,0.1); border: 1px solid var(--gray-200);">
                <div class="card-header" style="background: var(--white); padding: 32px 32px 24px; border-bottom: 1px solid var(--gray-200);">
                    <h2 style="color: var(--text-primary); margin: 0; font-size: 1.5rem; display: flex; align-items: center; gap: 12px;">
                        <i class="material-icons" style="color: var(--primary-color);">tune</i>
                        Search Filters
                    </h2>
                </div>
                <div class="card-text" style="padding: 32px;">
                    <div class="layout" style="gap: 20px;">
                        <div class="flex xs12 md6">
                            <div class="form-group" style="margin-bottom: 24px;">
                                <label class="form-label" for="searchInput" style="color: var(--text-primary); font-weight: 600; margin-bottom: 8px; display: block; font-size: 0.95rem;">Provider Name or Service</label>
                                <div style="position: relative;">
                                    <i class="material-icons" style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--primary-color); font-size: 20px;">search</i>
                                    <input type="text" id="searchInput" class="form-control" placeholder="Search hospitals, doctors, or services..."
                                           style="padding: 16px 16px 16px 52px; border: 2px solid var(--gray-300); border-radius: 12px; font-size: 16px; transition: all 0.3s ease; background: var(--white); width: 100%; box-sizing: border-box;">
                                </div>
                            </div>
                        </div>
                        <div class="flex xs12 md3">
                            <div class="form-group" style="margin-bottom: 24px;">
                                <label class="form-label" for="countryFilter" style="color: var(--text-primary); font-weight: 600; margin-bottom: 8px; display: block; font-size: 0.95rem;">Country</label>
                                <div style="position: relative;">
                                    <i class="material-icons" style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--primary-color); font-size: 20px;">public</i>
                                    <select id="countryFilter" class="form-control" style="padding: 16px 16px 16px 52px; border: 2px solid var(--gray-300); border-radius: 12px; font-size: 16px; transition: all 0.3s ease; background: var(--white); width: 100%; box-sizing: border-box;">
                                        <option value="">All Countries</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="flex xs12 md3">
                            <div class="form-group" style="margin-bottom: 24px;">
                                <label class="form-label" for="cityFilter" style="color: var(--text-primary); font-weight: 600; margin-bottom: 8px; display: block; font-size: 0.95rem;">City</label>
                                <div style="position: relative;">
                                    <i class="material-icons" style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--primary-color); font-size: 20px;">location_city</i>
                                    <select id="cityFilter" class="form-control" style="padding: 16px 16px 16px 52px; border: 2px solid var(--gray-300); border-radius: 12px; font-size: 16px; transition: all 0.3s ease; background: var(--white); width: 100%; box-sizing: border-box;">
                                        <option value="">All Cities</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="layout" style="gap: 20px; margin-bottom: 24px;">
                        <div class="flex xs12 md4">
                            <div class="form-group" style="margin-bottom: 24px;">
                                <label class="form-label" for="specializationFilter" style="color: var(--text-primary); font-weight: 600; margin-bottom: 8px; display: block; font-size: 0.95rem;">Specialization</label>
                                <div style="position: relative;">
                                    <i class="material-icons" style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--primary-color); font-size: 20px;">medical_services</i>
                                    <select id="specializationFilter" class="form-control" style="padding: 16px 16px 16px 52px; border: 2px solid var(--gray-300); border-radius: 12px; font-size: 16px; transition: all 0.3s ease; background: var(--white); width: 100%; box-sizing: border-box;">
                                        <option value="">All Specializations</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="flex xs12 md4">
                            <div class="form-group" style="margin-bottom: 24px;">
                                <label class="form-label" for="ratingFilter" style="color: var(--text-primary); font-weight: 600; margin-bottom: 8px; display: block; font-size: 0.95rem;">Minimum Rating</label>
                                <div style="position: relative;">
                                    <i class="material-icons" style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--primary-color); font-size: 20px;">star</i>
                                    <select id="ratingFilter" class="form-control" style="padding: 16px 16px 16px 52px; border: 2px solid var(--gray-300); border-radius: 12px; font-size: 16px; transition: all 0.3s ease; background: var(--white); width: 100%; box-sizing: border-box;">
                                        <option value="">Any Rating</option>
                                        <option value="4">4+ Stars</option>
                                        <option value="3">3+ Stars</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="flex xs12 md4">
                            <div class="form-group" style="margin-bottom: 24px;">
                                <label class="form-label" style="color: transparent; font-weight: 600; margin-bottom: 8px; display: block; font-size: 0.95rem;">Search</label>
                                <button type="button" id="searchBtn" class="btn btn-primary" style="width: 100%; padding: 16px; border-radius: 12px; font-size: 16px; font-weight: 600; background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); border: none; box-shadow: 0 4px 20px rgba(67, 146, 241, 0.25); transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                    <i class="material-icons" style="font-size: 20px;">search</i>
                                    Search Providers
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advanced Filters -->
                    <div class="layout" style="margin-top: 20px;">
                        <div class="flex xs12 md3">
                            <div class="form-group">
                                <label class="form-label" for="minRating">Min Rating</label>
                                <select id="minRating" class="form-control">
                                    <option value="">Any Rating</option>
                                    <option value="4.0">4.0+</option>
                                    <option value="4.5">4.5+</option>
                                    <option value="4.8">4.8+</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex xs12 md3">
                            <div class="form-group">
                                <label class="form-label" for="sortBy">Sort By</label>
                                <select id="sortBy" class="form-control">
                                    <option value="rating">Rating</option>
                                    <option value="reviews">Reviews</option>
                                    <option value="name">Name</option>
                                    <option value="location">Location</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex xs12 md3">
                            <div class="form-group">
                                <label class="form-label" for="sortOrder">Order</label>
                                <select id="sortOrder" class="form-control">
                                    <option value="desc">Highest First</option>
                                    <option value="asc">Lowest First</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex xs12 md3">
                            <div class="form-group">
                                <label class="form-label" for="limitSelect">Results per page</label>
                                <select id="limitSelect" class="form-control">
                                    <option value="10">10</option>
                                    <option value="20" selected>20</option>
                                    <option value="50">50</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading indicator -->
            <div id="loadingIndicator" class="text-center hidden" style="margin: 20px 0;">
                <div class="progress">
                    <div class="progress-bar"></div>
                </div>
                <p>Loading providers...</p>
            </div>

            <!-- Provider List -->
            <div id="providerList" class="mt-3">
                <div class="card">
                    <div class="card-title">
                        <h3>Healthcare Providers <span id="resultCount"></span></h3>
                    </div>
                    <div class="card-text">
                        <div id="providerResults" class="layout">
                            <!-- Results will be populated here -->
                        </div>
                        
                        <!-- Pagination -->
                        <div id="pagination" class="text-center mt-3 hidden">
                            <button id="prevPage" class="btn btn-outline btn-primary">Previous</button>
                            <span id="pageInfo" style="margin: 0 20px;"></span>
                            <button id="nextPage" class="btn btn-outline btn-primary">Next</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Best Rated Hospitals. All rights reserved.</p>
        </div>
    </footer>

    <script>
        const API_BASE_URL = 'https://healthier-a4a89cbfae6a.herokuapp.com/api';
        let currentPage = 1;
        let totalPages = 1;
        let availableFilters = {};

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadInitialData();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('searchBtn').addEventListener('click', searchProviders);
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchProviders();
            });
            
            // Filter change listeners
            ['countryFilter', 'cityFilter', 'specializationFilter', 'minRating', 'sortBy', 'sortOrder'].forEach(id => {
                document.getElementById(id).addEventListener('change', searchProviders);
            });
            
            // Pagination listeners
            document.getElementById('prevPage').addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    searchProviders();
                }
            });
            
            document.getElementById('nextPage').addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    searchProviders();
                }
            });
        }

        async function loadInitialData() {
            try {
                showLoading(true);
                const response = await fetch(`${API_BASE_URL}/customer/providers/rated`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    availableFilters = data.data.filters;
                    populateFilterOptions();
                    displayProviders(data.data.providers);
                    updatePagination(data.data.pagination);
                }
            } catch (error) {
                console.error('Error loading initial data:', error);
                showError('Failed to load providers. Please try again.');
            } finally {
                showLoading(false);
            }
        }

        function populateFilterOptions() {
            // Populate countries
            const countrySelect = document.getElementById('countryFilter');
            availableFilters.availableCountries?.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                countrySelect.appendChild(option);
            });

            // Populate cities
            const citySelect = document.getElementById('cityFilter');
            availableFilters.availableCities?.forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                citySelect.appendChild(option);
            });

            // Populate specializations
            const specializationSelect = document.getElementById('specializationFilter');
            availableFilters.availableSpecializations?.forEach(spec => {
                const option = document.createElement('option');
                option.value = spec;
                option.textContent = spec;
                specializationSelect.appendChild(option);
            });
        }

        async function searchProviders() {
            try {
                showLoading(true);
                
                const params = new URLSearchParams();
                
                // Get filter values
                const searchTerm = document.getElementById('searchInput').value;
                const country = document.getElementById('countryFilter').value;
                const city = document.getElementById('cityFilter').value;
                const specialization = document.getElementById('specializationFilter').value;
                const minRating = document.getElementById('minRating').value;
                const sortBy = document.getElementById('sortBy').value;
                const sortOrder = document.getElementById('sortOrder').value;
                const limit = document.getElementById('limitSelect').value;
                
                // Add parameters
                if (searchTerm) params.append('service', searchTerm);
                if (country) params.append('country', country);
                if (city) params.append('city', city);
                if (specialization) params.append('specialization', specialization);
                if (minRating) params.append('minRating', minRating);
                if (sortBy) params.append('sortBy', sortBy);
                if (sortOrder) params.append('sortOrder', sortOrder);
                params.append('page', currentPage);
                params.append('limit', limit);
                
                const response = await fetch(`${API_BASE_URL}/customer/providers/rated?${params}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    displayProviders(data.data.providers);
                    updatePagination(data.data.pagination);
                } else {
                    showError('Search failed. Please try again.');
                }
            } catch (error) {
                console.error('Error searching providers:', error);
                showError('Search failed. Please check your connection.');
            } finally {
                showLoading(false);
            }
        }

        function displayProviders(providers) {
            const resultsContainer = document.getElementById('providerResults');
            const resultCount = document.getElementById('resultCount');
            
            resultCount.textContent = `(${providers.length} results)`;
            
            if (providers.length === 0) {
                resultsContainer.innerHTML = '<div class="text-center"><p>No providers found matching your criteria.</p></div>';
                return;
            }
            
            resultsContainer.innerHTML = providers.map(provider => `
                <div class="flex xs12 md6">
                    <div class="card blue-gradient">
                        <div class="card-text">
                            <div class="layout">
                                <div class="flex">
                                    <h4 class="white--text">${provider.name}</h4>
                                    <p class="white--text">
                                        <span class="icon">location_city</span> ${provider.location}
                                    </p>
                                    <p class="white--text">
                                        <span class="icon">room</span> ${provider.city}, ${provider.country}
                                    </p>
                                    <p class="white--text">
                                        <span class="icon">local_hospital</span> ${provider.specialization}
                                    </p>
                                    <p class="white--text">
                                        <span class="icon">phone</span> ${provider.contactInfo.phone}
                                    </p>
                                    <p class="white--text">
                                        <span class="icon">schedule</span> Available: ${provider.availability}
                                    </p>
                                </div>
                                <div class="flex" style="flex: 0 0 120px;">
                                    <div class="stat-card">
                                        <div class="stat-value">${provider.averageRating}</div>
                                        <div class="stat-title">Rating</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-value">${provider.totalReviews}</div>
                                        <div class="stat-title">Reviews</div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center mt-3">
                                <button class="btn btn-outline white--text" onclick="viewProviderDetails('${provider.id}')">
                                    <span class="icon">visibility</span> View Details
                                </button>
                                <button class="btn btn-outline white--text" onclick="leaveReview('${provider.id}', '${provider.name.replace(/'/g, "\\'")}')">
                                    <span class="icon">rate_review</span> Leave Review
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updatePagination(pagination) {
            totalPages = pagination.totalPages;
            currentPage = pagination.page;
            
            const paginationDiv = document.getElementById('pagination');
            const pageInfo = document.getElementById('pageInfo');
            const prevBtn = document.getElementById('prevPage');
            const nextBtn = document.getElementById('nextPage');
            
            if (totalPages > 1) {
                paginationDiv.classList.remove('hidden');
                pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
                prevBtn.disabled = currentPage === 1;
                nextBtn.disabled = currentPage === totalPages;
            } else {
                paginationDiv.classList.add('hidden');
            }
        }

        function showLoading(show) {
            const loadingIndicator = document.getElementById('loadingIndicator');
            if (show) {
                loadingIndicator.classList.remove('hidden');
            } else {
                loadingIndicator.classList.add('hidden');
            }
        }

        function showError(message) {
            alert(message); // In production, use a better error display
        }

        function viewProviderDetails(providerId) {
            // Navigate to provider details page
            window.location.href = `hospital.html?id=${providerId}`;
        }

        function leaveReview(providerId, providerName) {
            // Navigate to review page
            window.location.href = `review.html?providerId=${providerId}&providerName=${encodeURIComponent(providerName)}`;
        }
    </script>
    <script>
        function toggleMobileNav() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            const navLinks = document.querySelectorAll('.nav-links a');
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    document.getElementById('navLinks').classList.remove('active');
                });
            });
        });
    </script>
</body>
</html>
